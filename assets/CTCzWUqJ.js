import{y as e,f as t,j as n,l as i,m as a,k as r,o,t as s,i as l,h as c,b as d,c as m,s as g,e as h,S as f,p as u,d as v}from'./index-DUWoU8p-.js';import{b as p}from'./BNdUXRns.js';const x=e('https://longuirom-be.onrender.com/chat');x.on('connect',(()=>{x.emit('events')})),x.on('disconnect',(()=>{})),x.on('online',(e=>{t({online:+e})}));var y=s('<img alt>'),w=s('<div><mdui-card variant=filled class="max-w-[60%] break-words p-3"></mdui-card><p class="-translate-y-2 text-sm opacity-50"></p><p class="-translate-y-2 text-sm opacity-50"></p><br>',!0,!1,!1),b=s('<main><div class="bg-md3 fixed inset-0 z-50 overflow-x-hidden px-5 py-5"><div class="flex h-full flex-col justify-between"><div><h1 class="py-3 text-5xl font-medium leading-tight">Chat (chat fight) - Online: </h1><div class="flex flex-wrap gap-1"></div><hr></div><br><div class="flex-1 overflow-x-hidden overflow-y-scroll scroll-smooth"></div><div><div class="flex items-center gap-5"><mdui-text-field variant=outlined label=Message></mdui-text-field><mdui-button-icon variant=tonal icon=send>',!0,!1,!1),S=s('<mdui-chip elevated> typing...',!0,!1,!1);const k=e=>{return t=w(),n=t.firstChild,i=n.nextSibling,a=i.nextSibling,n._$owner=c(),l(n,d(f,{get when(){return e.image},get fallback(){return h((()=>e.content))},get children(){var t=y();return m((()=>g(t,'src',e.image))),t}})),l(i,(()=>e.nickname)),l(a,(()=>e.time)),m((()=>t.classList.toggle('text-end',!!e.right))),t;var t,n,i,a};let C;const D=()=>{const[e,t]=n(''),[s,g]=n(''),[h,f]=n([{nickname:'Author',content:'Start',time:(new Date).toISOString()}]),[v,y]=n([]),[w,D]=n(!1),[O,$]=n(0),I=n=>{if('Enter'===n.key){n.preventDefault();const i=(new Date).toISOString();f((t=>[...t,{time:i,nickname:s(),content:e(),right:!0}])),E(e(),s(),'',(new Date).toISOString()),t('')}else n.target.value&&t(n.target.value)},L=()=>{const n=(new Date).toISOString();f((t=>[...t,{time:n,nickname:s(),content:e(),right:!0}])),E(e(),s(),'',(new Date).toISOString()),t('')},E=(e,t,n,i)=>{x.emit('send-chat',{message:e,nickname:t,image:n,time:i}),x.emit('remove-typing',t),D(!1)};i(a(h,(()=>{setTimeout((()=>{C&&(C.scrollTop=C.scrollHeight)}),500)}))),r((async()=>{document.body.style.overflowY='hidden';try{const e=prompt('Nickname');e?x.on('connect',(()=>{x.emit('nickname',e),g(e),console.log(s())})):window.location.href='/'}catch{window.location.href='/'}x.on('receive-chat',(e=>{e.nickname!==s()&&f((t=>[...t,e]))})),x.on('receive-typing',(e=>{y((t=>[...t,e])),console.log({data:e})})),x.on('remove-typing',(e=>{y((t=>t.filter((t=>t!==e)))),console.log({data:e})})),x.on('chat-online',(e=>{$(e)}))})),o((()=>{document.body.style.overflowY='unset'}));const j=()=>{w()||(x.emit('typing',s()),D(!0))},_=()=>{e()||(x.emit('remove-typing',s()),D(!1))},A=n=>{const i=n.clipboardData.items;for(let a=0;a<i.length;a++){const n=i[a];if(-1!==n.type.indexOf('image')){const i=n.getAsFile();p(i).then((n=>{const i=(new Date).toISOString();f((e=>[...e,{time:i,nickname:s(),content:'',image:n+'',right:!0}])),E(e(),s(),n+'',(new Date).toISOString()),t('')})).catch((e=>{console.error('Lỗi khi chuyển Blob thành Base64:',e)}))}}};return(()=>{var n=b(),i=n.firstChild.firstChild.firstChild,a=i.firstChild;a.firstChild;var r=a.nextSibling,o=i.nextSibling.nextSibling,s=o.nextSibling.firstChild.firstChild,g=s.nextSibling;l(a,O,null),l(r,(()=>v().map((e=>{return t=S(),n=t.firstChild,t._$owner=c(),l(t,e,n),t;var t,n}))));return'function'==typeof C?u(C,o):C=o,l(o,(()=>h().map((e=>d(k,{get content(){return e.content},get time(){return e.time},get right(){return e.right},get nickname(){return e.nickname},get image(){return e.image}}))))),s.addEventListener('paste',A),s.addEventListener('blur',_),s.addEventListener('focus',j),s.$$input=e=>t(e.target.value),s.addEventListener('keypress',I),s._$owner=c(),g.$$click=L,g._$owner=c(),m((()=>g.disabled=!e())),m((()=>s.value=e())),n})()};v(['input','click']);export{D as default};
